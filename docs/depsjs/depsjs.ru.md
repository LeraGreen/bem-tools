# Технология для описания зависимостей

* [Введение](#Введение)
* [Используемые обозначения](#Используемые-обозначения)
* [Синтаксис DEPS](#Синтаксис-deps)
* [Примеры](#Примеры)

## Введение

Для указания зависимостей от иных блоков, элементов, модификаторов и технологий используются файлы-технологии `deps.js`.

Зависимости описываются для всех БЭМ-сущностей, если они разнесены на файловой системе и не отражены во входящем BEMJSON-файле.

**Пример**

*Шаблон `search-form.bemhtml.js`*

```js
block('search-form')(
    content()({
        block: 'button'
    },{
        block: 'input'
    })
);
```

Чтобы подключить на проект стили и скрипты блоков `button` и `input`, понадобится создать файл `search-form.deps.js`:

```js
/* search-form ---> button;  search-form ---> input */
({
    shouldDeps: [
        { block: 'button' },
        { block: 'input' }
    ]
})
```

В процессе сборки все описанные для блоков `button` и `input` технологии будут автоматически собраны в финальные наборы файлов (бандлы) со всех [уровней переопределения](https://ru.bem.info/methodology/key-concepts/#Уровень-переопределения).

**Пример**

![Сборка БЭМ-проекта](https://rawgit.com/bem-archive/bem-tools/godfreyd-deps/docs/depsjs/build__decl__search-form.svg#)

Для явного указания зависимостей от технологии используется поле `tech`. По зависимостям подключатся БЭМ-сущности в описанной технологии.

**Пример**

*Файл `search-form.deps.js`*

```js
/* search-form ---> button.bemhtml;  search-form ---> input.bemhtml */
({
    shouldDeps: [
        { block: 'button', tech: 'bemhtml' },
        { block: 'input', tech: 'bemhtml' }
    ]
})
```

![Сборка по технологии ](https://rawgit.com/bem-archive/bem-tools/godfreyd-deps/docs/depsjs/build__decl__search-form__tech.svg#)

## Используемые обозначения

Для короткой записи зависимостей в комментариях используются следующие условные обозначения:

* `/* b1 ---> b2 */` — блок `b1` зависит от блока `b2`;
* `/* b1 ---> b1__e1 */` — блок `b1` зависит от своего элемента `b1__e1`;
* `/* b1 ---> b1__e1_m1_v1 */` — блок `b1` зависит от своего модификатора `b1__e1_m1_v1`;
* `/* b1.js ---> b2.bemhtml */` — блок `b1` в технологии реализации JavaScript зависит от блока `b2` в технологии реализации BEMHTML.

## Синтаксис DEPS

**DEPS-сущность** — сущность, определяющая зависимость между [БЭМ-сущностями](https://ru.bem.info/methodology/key-concepts/#БЭМ-сущность).

Формат представления DEPS-сущности в файле `deps.js` имеет следующий синтаксис:

```js
({
    /* DEPS-сущность */
})
```

Полная запись DEPS-сущности имеет следующий вид:

```js
/* DEPS-сущность */
({
    block : 'block-name',
    elem  : 'elem-name',
    mod   : 'modName',
    val   : 'modValue',
    tech  : 'techName',
    mustDeps   : [ /* BEM-сущность */ ],
    shouldDeps : [ /* BEM-сущность */ ],
    noDeps     : [ /* BEM-сущность */ ],
    include    : false
})
```

Все поля являются опциональными. Поля `block`, `elem`, `mod`, `val`, `tech` указывают, для какой BEM-сущности/технологии необходимо подключить зависимость, а `mustDeps`, `shouldDeps`, `noDeps` определяют зависимость.

Поля DEPS-сущности:

  * `block` (строка) — имя блока;
  * `elem` (строка) — имя элемента;
  * `mod` (строка) — имя модификатора;
  * `val` (строка) — значение модификатора;
  * `tech` (строка) — технология, для которой собираются зависимости (например, JS);
  * `mustDeps` (массив/объект) — определяет зависимости, которые гарантировано попадут в результаты сборки до кода БЭМ-сущности, в которой эти зависимости объявлены;
  * `shouldDeps` (массив/объект) — определяет зависимости, порядок подключения которых не важен;
  * `noDeps` (массив/объект) — отменяет зависимости от более низких уровней переопределения до того уровня, на котором объявлен `noDeps`.

Поля, относящиеся к сущности, для которой декларируется зависимость, могут быть восстановлены из контекста по имени файла. Поэтому следующие записи для файла `b1__e1_m1_v1.deps.js` эквивалентны:

```js
/* b1__e1_m1_v1 ---> b2 */
({
    block: 'b1',
    elem: 'e1',
    mod: 'm1',
    val: 'v1',
    mustDeps : { block : 'b2' }
})
```

```js
/* b1__e1_m1_v1 ---> b2 */
({
    mustDeps: { block: 'b2' }
})
```

> См. также
> [Синтаксис DEPS и базовые типы данных](specification.ru.md)

## Примеры

### Подключение блока

Файл `b1.deps.js`:

```js
/* b1 ---> b2 */
({
    shouldDeps : { block : 'b2' }
})
```

### Подключение элемента

Файл `b1.deps.js`:

```js
/* b1 ---> b1__e1 */
({
    shouldDeps : { block : 'b1', elem : 'e1' }
})
```
**Примечание** Поле `elem` подключает только элемент, но не сам блок.

### Подключение модификатора

#### Модификатор вида «ключ-значение»

Файл `b1.deps.js`:

```js
/* b1 ---> b1_m1_v1 */
({
    shouldDeps : { block : 'b1', mod: 'm1', val: 'v1' }
})
```

#### Булевый модификатор

Файл `b1.deps.js`:

```js
/* b1 ---> b1_m1 */
({
    shouldDeps : { block : 'b1', mod: 'm1' }
})
```

*ИЛИ*

Файл `b1.deps.js`:

```js
/* b1 ---> b1_m1 */
({
    shouldDeps : { block : 'b1', mod: 'm1', val: true  }
})
```

### Подключение зависимостей по технологии

Файл `b1.deps.js`:

```js
/* b1.js ---> b1_m1_v1.bemhtml */
({
    tech: 'js',
    mustDeps: [
        {
            block: 'b1',
            mod: 'm1',
            val: 'v1',
            tech: 'bemhtml'
        }
    ]
})
```

**Примечание** Подключение зависимостей по технологии (`depsByTech`) используется, например, для того, чтобы собрать в клиентский JavaScript-бандл шаблоны только тех блоков, которые будут использованы в браузере. При такой схеме часть шаблонизации происходит на стороне сервера и, следовательно, некоторые шаблоны на клиенте никогда не используются.
